name: Update Kaggle Stats

on:
  schedule:
    - cron: '0 */12 * * *' # Every 12 hours
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Install deps
        run: |
          sudo apt-get update
          sudo apt-get install -y curl jq imagemagick

      - name: Fetch Kaggle Stats (HTML scrape)
        run: |
          curl -s https://www.kaggle.com/aromaldileep > profile.html

      - name: Generate Kaggle Stats Card
        run: |
          # Extract data from Kaggle profile HTML (2025 working patterns)
          followers=$(grep -oP '[0-9]+(?= followers)' profile.html | head -1)
          notebooks=$(grep -oP 'href="/aromaldileep/code"[^>]*>\s*<span[^>]*>\K[0-9]+' profile.html | head -1)
          datasets=$(grep -oP 'href="/aromaldileep/datasets"[^>]*>\s*<span[^>]*>\K[0-9]+' profile.html | head -1)
          competitions=$(grep -oP 'Performance Tier</div>\s*<div[^>]*>\K[0-9]+' profile.html | head -1)

          mkdir -p assets/kaggle

          convert -size 900x350 xc:"#0d1117" \
            -fill "#00FF87" -pointsize 40 -gravity NorthWest -annotate +30+40 "Kaggle: aromaldileep" \
            -fill "#E0FFE0" -pointsize 22 -annotate +30+110 "Followers: ${followers:-0}" \
            -fill "#E0FFE0" -annotate +30+150 "Notebooks: ${notebooks:-0}" \
            -fill "#E0FFE0" -annotate +30+190 "Datasets: ${datasets:-0}" \
            -fill "#E0FFE0" -annotate +30+230 "Competition Tier: ${competitions:-N/A}" \
            assets/kaggle/kaggle.png



      - name: Commit & Push
        run: |
          git config user.name "github-actions"
          git config user.email "actions@github.com"
          git add assets/kaggle/kaggle.png
          git commit -m "Updated Kaggle Stats" || echo "No changes"
          git push
